<html>
<head>

  <title>PIANO.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="icon" type="img/ico" href="favicon.ico">
  <link rel="stylesheet" href="../dist/PIANO.css">
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  <link rel="stylesheet" href="demo.css">
  <link rel="stylesheet" href="http://yandex.st/highlightjs/7.5/styles/github.min.css?ver=3.6.1">
  <link href='http://fonts.googleapis.com/css?family=Oswald:300,400,400italic,700' rel='stylesheet' type='text/css'>
  <script lang="text/javascript" src="../bower_components/jquery/dist/jquery.js"></script>
  <script type="text/javascript" src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>
  <script type="text/javascript">
    hljs.initHighlightingOnLoad();
  </script>

</head>
<body>

  <header>

    <h1 class="text-left">PIANO.js</h1>
    <h2 class="text-left">A browser-based sequencer + synthesizer thingy</h2>
    <a href="https://github.com/ansonkao/PIANO.js">
      <img id="github"
           src="https://camo.githubusercontent.com/a6677b08c955af8400f44c6298f40e7d19cc5b2d/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677261795f3664366436642e706e67"
           alt="Fork me on GitHub"
           data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"
      >
    </a>

    <form id="transport" class="form-inline">
      <button id="play" class="btn btn-default" type="button" style="color: #080;"><span class="glyphicon glyphicon-play"></span> Play</button>
      <button id="stop" class="btn btn-default" type="button" style="color: #000;"><span class="glyphicon glyphicon-stop"></span> Stop</button>
      <input id="tempo" class="form-control " type="number" step="1" value="105" style="width: 100px;" />
      <!--
      <input id="note_velocity" class="form-control input-lg" type="number" step="1" value="50" />
      -->
    </form>

  </header>

  <main>
    <div class="page">

      <div id="target-wrapper">
        <div id="target" class="gripscroll">
        </div>
      </div>

      <div id="keyboard" class="keyboard">
        <div id="keybed" class="keybed">
          <div note="88" class="key white regular"></div>
          <div note="87" class="key white regular"></div>
          <div note="86" class="key black higher "></div>
          <div note="85" class="key white regular"></div>
          <div note="84" class="key black regular"></div>
          <div note="83" class="key white regular"></div>
          <div note="82" class="key black lower  "></div>
          <div note="81" class="key white regular"></div>
          <div note="80" class="key white regular"></div>
          <div note="79" class="key black higher "></div>
          <div note="78" class="key white thinner"></div>
          <div note="77" class="key black lower  "></div>
          <div note="76" class="key white regular"></div>
          <div note="75" class="key white regular"></div>
          <div note="74" class="key black higher "></div>
          <div note="73" class="key white regular"></div>
          <div note="72" class="key black regular"></div>
          <div note="71" class="key white regular"></div>
          <div note="70" class="key black lower  "></div>
          <div note="69" class="key white regular"></div>
          <div note="68" class="key white regular"></div>
          <div note="67" class="key black higher "></div>
          <div note="66" class="key white thinner"></div>
          <div note="65" class="key black lower  "></div>
          <div note="64" class="key white regular"></div>
          <div note="63" class="key white regular"></div>
          <div note="62" class="key black higher "></div>
          <div note="61" class="key white regular"></div>
          <div note="60" class="key black regular"></div>
          <div note="59" class="key white regular"></div>
          <div note="58" class="key black lower  "></div>
          <div note="57" class="key white regular"></div>
          <div note="56" class="key white regular"></div>
          <div note="55" class="key black higher "></div>
          <div note="54" class="key white thinner"></div>
          <div note="53" class="key black lower  "></div>
          <div note="52" class="key white regular"></div>
          <div note="51" class="key white regular"></div>
          <div note="50" class="key black higher "></div>
          <div note="49" class="key white regular"></div>
          <div note="48" class="key black regular"></div>
          <div note="47" class="key white regular"></div>
          <div note="46" class="key black lower  "></div>
          <div note="45" class="key white regular"></div>
          <div note="44" class="key white regular"></div>
          <div note="43" class="key black higher "></div>
          <div note="42" class="key white thinner"></div>
          <div note="41" class="key black lower  "></div>
          <div note="40" class="key white regular"></div>
          <div note="39" class="key white regular"></div>
          <div note="38" class="key black higher "></div>
          <div note="37" class="key white regular"></div>
          <div note="36" class="key black regular"></div>
          <div note="35" class="key white regular"></div>
          <div note="34" class="key black lower  "></div>
          <div note="33" class="key white regular"></div>
          <div note="32" class="key white regular"></div>
          <div note="31" class="key black higher "></div>
          <div note="30" class="key white thinner"></div>
          <div note="29" class="key black lower  "></div>
          <div note="28" class="key white regular"></div>
          <div note="27" class="key white regular"></div>
          <div note="26" class="key black higher "></div>
          <div note="25" class="key white regular"></div>
          <div note="24" class="key black regular"></div>
          <div note="23" class="key white regular"></div>
          <div note="22" class="key black lower  "></div>
          <div note="21" class="key white regular"></div>
          <div note="10" class="key white regular"></div>
          <div note="19" class="key black higher "></div>
          <div note="18" class="key white thinner"></div>
          <div note="17" class="key black lower  "></div>
          <div note="16" class="key white regular"></div>
          <div note="15" class="key white regular"></div>
          <div note="14" class="key black higher "></div>
          <div note="13" class="key white regular"></div>
          <div note="12" class="key black regular"></div>
          <div note="11" class="key white regular"></div>
          <div note="10" class="key black lower  "></div>
          <div note="9"  class="key white regular"></div>
          <div note="8"  class="key white regular"></div>
          <div note="7"  class="key black higher "></div>
          <div note="6"  class="key white thinner"></div>
          <div note="5"  class="key black lower  "></div>
          <div note="4"  class="key white regular"></div>
          <div note="3"  class="key white regular"></div>
          <div note="2"  class="key black higher "></div>
          <div note="1"  class="key white regular"></div>
        </div>
      </div>

    </div>
  </main>

  <div id="dashboard">
    <canvas id="analyser1" class="analyser" width="200" height="100"></canvas>
  </div>

  <script lang="text/javascript" src="../dist/PIANO.js"></script>
  <script lang="text/javascript">
    var pianoParams = {};
        pianoParams.notes = [];
    /*
        pianoParams.notes = [ new Note({ key: 56, start: 0.000, end: 0.105, velocity: 127 })
                            , new Note({ key: 56, start: 0.125, end: 0.230, velocity: 127 })
                            , new Note({ key: 30, start: 0.000, end: 0.105, velocity: 127 })
                            , new Note({ key: 30, start: 0.125, end: 0.230, velocity: 127 })
                            , new Note({ key: 30, start: 0.375, end: 0.480, velocity: 127 })
                            , new Note({ key: 56, start: 0.375, end: 0.480, velocity: 127 })
                            , new Note({ key: 52, start: 0.625, end: 0.721, velocity: 127 })
                            , new Note({ key: 56, start: 0.750, end: 0.846, velocity: 127 })
                            , new Note({ key: 30, start: 0.625, end: 0.721, velocity: 127 })
                            , new Note({ key: 30, start: 0.750, end: 0.846, velocity: 127 })
                            , new Note({ key: 59, start: 1.000, end: 1.088, velocity: 127 })
                            , new Note({ key: 51, start: 1.000, end: 1.088, velocity: 127 })
                            , new Note({ key: 47, start: 1.000, end: 1.088, velocity: 127 })
                            , new Note({ key: 47, start: 1.500, end: 1.588, velocity: 127 })
                            , new Note({ key: 52, start: 2.000, end: 2.063, velocity: 127 })
                            , new Note({ key: 44, start: 2.000, end: 2.063, velocity: 127 })
                            , new Note({ key: 35, start: 2.000, end: 2.063, velocity: 127 })
                            , new Note({ key: 47, start: 2.375, end: 2.438, velocity: 127 })
                            , new Note({ key: 32, start: 2.375, end: 2.438, velocity: 127 })
                            , new Note({ key: 35, start: 1.000, end: 1.063, velocity: 127 })
                            , new Note({ key: 35, start: 1.500, end: 1.561, velocity: 127 })
                            , new Note({ key: 44, start: 2.750, end: 2.813, velocity: 127 })
                            , new Note({ key: 28, start: 2.750, end: 2.813, velocity: 127 })
                            , new Note({ key: 33, start: 3.125, end: 3.188, velocity: 127 })
                            , new Note({ key: 40, start: 3.125, end: 3.188, velocity: 127 })
                            , new Note({ key: 49, start: 3.125, end: 3.188, velocity: 127 })
                            , new Note({ key: 40, start: 2.375, end: 2.438, velocity: 127 })
                            , new Note({ key: 35, start: 2.750, end: 2.813, velocity: 127 })
                            , new Note({ key: 51, start: 3.375, end: 3.438, velocity: 127 })
                            , new Note({ key: 50, start: 3.625, end: 3.688, velocity: 127 })
                            , new Note({ key: 42, start: 3.375, end: 3.438, velocity: 127 })
                            , new Note({ key: 35, start: 3.375, end: 3.438, velocity: 127 })
                            , new Note({ key: 41, start: 3.625, end: 3.688, velocity: 127 })
                            , new Note({ key: 34, start: 3.625, end: 3.688, velocity: 127 })
                            , new Note({ key: 49, start: 3.777, end: 3.869, velocity: 127 })
                            , new Note({ key: 40, start: 3.777, end: 3.869, velocity: 127 })
                            , new Note({ key: 33, start: 3.777, end: 3.869, velocity: 127 })
                            , new Note({ key: 40, start: 4.000, end: 4.063, velocity: 127 })
                            , new Note({ key: 47, start: 4.000, end: 4.063, velocity: 127 })
                            , new Note({ key: 32, start: 4.000, end: 4.063, velocity: 127 })
                            , new Note({ key: 56, start: 4.151, end: 4.213, velocity: 127 })
                            , new Note({ key: 47, start: 4.151, end: 4.213, velocity: 127 })
                            , new Note({ key: 40, start: 4.151, end: 4.213, velocity: 127 })
                            , new Note({ key: 44, start: 4.331, end: 4.394, velocity: 127 })
                            , new Note({ key: 51, start: 4.331, end: 4.394, velocity: 127 })
                            , new Note({ key: 59, start: 4.331, end: 4.394, velocity: 127 })
                            , new Note({ key: 46, start: 0.375, end: 0.479, velocity: 127 })
                            , new Note({ key: 46, start: 0.125, end: 0.229, velocity: 127 })
                            , new Note({ key: 46, start: 0.000, end: 0.104, velocity: 127 })
                            , new Note({ key: 46, start: 0.625, end: 0.715, velocity: 127 })
                            , new Note({ key: 46, start: 0.750, end: 0.840, velocity: 127 })
                            , new Note({ key: 45, start: 4.500, end: 4.563, velocity: 127 })
                            , new Note({ key: 52, start: 4.500, end: 4.563, velocity: 127 })
                            , new Note({ key: 61, start: 4.500, end: 4.563, velocity: 127 })
                            , new Note({ key: 42, start: 4.688, end: 4.750, velocity: 127 })
                            , new Note({ key: 52, start: 5.250, end: 5.313, velocity: 127 })
                            , new Note({ key: 54, start: 5.375, end: 5.438, velocity: 127 })
                            , new Note({ key: 51, start: 5.500, end: 5.563, velocity: 127 })
                            , new Note({ key: 44, start: 5.250, end: 5.313, velocity: 127 })
                            , new Note({ key: 45, start: 5.375, end: 5.438, velocity: 127 })
                            , new Note({ key: 42, start: 5.500, end: 5.563, velocity: 127 })
                            , new Note({ key: 37, start: 5.250, end: 5.313, velocity: 127 })
                            , new Note({ key: 39, start: 5.375, end: 5.438, velocity: 127 })
                            , new Note({ key: 35, start: 5.500, end: 5.563, velocity: 127 })
                            , new Note({ key: 49, start: 4.688, end: 4.750, velocity: 127 })
                            , new Note({ key: 57, start: 4.688, end: 4.750, velocity: 127 })
                            , new Note({ key: 56, start: 5.000, end: 5.063, velocity: 127 })
                            , new Note({ key: 49, start: 5.000, end: 5.063, velocity: 127 })
                            , new Note({ key: 40, start: 5.000, end: 5.063, velocity: 127 })
                            , new Note({ key: 59, start: 4.813, end: 4.875, velocity: 127 })
                            , new Note({ key: 51, start: 4.813, end: 4.875, velocity: 127 })
                            , new Note({ key: 44, start: 4.813, end: 4.875, velocity: 127 })
                            ];
                            */
        pianoParams.clipLength = 4;

    var scrollParams = { x: {min: 0.000, max: 0.000 }
                       , y: {min: 0.000, max: 0.000 }
                       , smallestZoomX: 0.5
                       , smallestZoomY: 0.0306125
                       };

    var target   = document.getElementById('target');
    var keyboard = document.getElementById('keyboard');
    var keybed   = document.getElementById('keybed');

         PIANO.initialize( target, pianoParams  );
    GripScroll.add( target, scrollParams );

    GripScroll.triggerUpdate( target );

    // Keyboard scrolling
    target.addEventListener('gripscroll-update', function(e){
      var visibleRatio = e.gripScrollX.max - e.gripScrollX.min;
      keybed.style.marginLeft  = "-" + (        e.gripScrollX.min   * 100.0 / visibleRatio ) + "%";
      keybed.style.marginRight = "-" + ( (1.0 - e.gripScrollX.max ) * 100.0 / visibleRatio ) + "%";
    });

    // Keyboard click
    $(".key").on("mousedown", function(event){
      // Velocity based on position within key
      var velocity;
      switch( $(this).height() > $(this).width() )
      {
        // Vertically oriented keys, check on Y axis
        case true:  velocity = 127 / $(this).height() * event.offsetY; break;
        case false: velocity = 127 / $(this).width()  * event.offsetX; break;
      }

      // Get the key
      var key = parseInt( $(this).attr('note') );

      // Play the key
      Transport.playSingleNote( key, velocity );
    }).on("mouseup mouseout", function(event){
      // Get the key
      var key = parseInt( $(this).attr('note') );

      // Stop the key
      Transport.playSingleNote( key, 0 );
    });



    // Hookup Transport UI to Transport Controller
    document.getElementById("play" ).addEventListener('click' , function(e){ Transport.playAll(); e.preventDefault(); });
    document.getElementById("stop" ).addEventListener('click' , function(e){ Transport.stop(); e.preventDefault(); });
    document.getElementById("tempo").addEventListener('change', function(e){ Transport.setTempo( this.value ); e.preventDefault(); });

  </script>

</body>
</html>
